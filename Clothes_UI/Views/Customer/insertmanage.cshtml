
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>insertmanage</title>
    <style>
        #content {
            width: 100%;
            height: 450px;
            box-shadow: 0px 0px 5px 5px lightgray;
        }

        #header {
            margin-top: 20px;
        }


        #header {
            /*border: 1px solid black;*/
            width: 100%;
            height: 100px;
        }

        #body {
            width: 100%;
            height: 400px;
            box-shadow: 0px 0px 5px 5px lightgray;
        }

        #bodycontent {
            margin-top: 400px;
            width: 100%;
            height: 100px;
        }

        #foot {
            width: 100%;
            height: 450px;
        }

        #footbody {
            margin-top: 80px;
            width: 100%;
            height: 100px;
        }
        #app2{
            width:1200px;
            margin: 0 auto;
            padding-top:100px;
            padding-bottom:100px;

        }
        .table1 tr td{
            padding:10px;
        }
    </style>
    <link href="~/Content/ElementUI/element-ui.css" rel="stylesheet" />
</head>
<body>
    <div id="app">
        <el-dialog :visible.sync="dialogVisible"
                   width="50%"
                  >
            <div style="font-size:30px; text-align:center;">添加产品数量</div>
            <div>
                <span style="font-size:15px;">产品数量：</span>
                <el-input-number v-model="num" :min="1" :max="99" label="描述文字" style="width:30%;"></el-input-number>
            </div>
            <span slot="footer" class="dialog-footer">
                <el-button>取 消</el-button>
                <el-button type="primary"  onclick="addqueding()">确 定</el-button>
            </span>
        </el-dialog>
    </div>
    <div id="content">
        <div style="width: 100%;"></div>
        <div id="header">
            <span style="font-size: 20px; margin: 20px;">商品详情信息</span>
            <div style="border: 1px solid lightgray; width: 100%; margin-top: 50px;"></div>
            <div id="add" style="margin-top:100px; margin-left:500px;">
                产品名称：
                <el-select v-model="name" placeholder="请选择">
                    <el-option v-for="item in options"
                              
                               :value="item"  style="width: 200px; ">
                    </el-option>
                </el-select>
                <span style="margin-left: 20px;">
                    产品编号：
                    <el-input placeholder="请输入内容" v-model="id" style="width: 200px;"></el-input>
                </span>
                <span style="margin-left: 20px;">
                    产品规格：
                    <el-input placeholder="请输入内容" v-model="size" style="width: 200px;"></el-input>
                </span>
                <div id="input1" style="margin-top: 20px;">
                    产品类别：   <el-input placeholder="请输入内容" v-model="type" style="width: 200px; "></el-input>
                    <span style="margin-left: 20px;">
                        产品单位：
                        <el-input placeholder="请输入内容" v-model="unit" style="width: 200px; margin-left:20px;"></el-input>
                    </span>
                    <span style="margin-left: 20px;">
                        产品单价：
                        <el-input placeholder="请输入内容" v-model="price" style="width: 200px;"></el-input>
                    </span>

                </div>
                <div id="input2" style="margin-top: 20px; margin-left:-20px;">
                    <span style="margin-left: 20px;">
                        厂商地址：
                        <el-input placeholder="请输入内容" v-model="address" style="width: 200px;"></el-input>
                    </span>
                    <span style="margin-left: 20px;">
                        产品编号：
                        <el-input placeholder="请输入内容" v-model="num" style="width: 200px;"></el-input>
                    </span>
                    <span style="margin-left: 20px;">
                        产商名称：
                        <el-input placeholder="请输入内容" v-model="producer" style="width: 200px;"></el-input>
                    </span>
                </div>
            </div>
        </div>
        <div id="body">
            <div id="bodycontent">
                <span style="font-size: 20px; margin: 20px;">客户资料</span>
                <el-button type="primary" onclick="addinfo()" style=" float: right; background-color: lightseagreen; height: 40px; width: 70px; margin-left: 10px;">新增</el-button>
                <el-button type="danger" style=" float: right;  height: 40px; width: 70px; margin-left: 10px;">删除</el-button>
                <div style="border: 1px solid lightgray; width: 100%; margin-top: 50px;"></div>
                <div style="margin-left:20px ; font-size:20px ;">
                    显示<select style="width: 60px; height: 40px; font-size:15px ; border-radius:5px ;">
                        <option value="volovo">1</option>
                        <option value="saab">2</option>
                        <option value="opel">3</option>
                        <option value="audi">4</option>
                        <option value="audi">5</option>
                        <option value="audi">6</option>
                        <option value="audi">7</option>
                        <option value="audi">8</option>
                        <option value="audi">9</option>
                        <option value="audi">10</option>
                        <option value="audi">11</option>
                        <option value="audi">12</option>

                    </select>条
                </div>
                @*订单详情*@
                <template>
                    <el-table border="1" :data="tableData"
                              style="width: 100%;" :header-cell-style="{background:'#eef1f6',color:'#606266'}">
                        <el-table-column label="产品ID" 
                                         prop="product_id">
                        </el-table-column>
                        <el-table-column label="产品名称"
                                         prop="product_name">
                        </el-table-column>
                        <el-table-column label="产品数量" 
                                         prop="product_details_num">
                        </el-table-column>
                        <el-table-column label="产品价格"
                                         prop="price">
                        </el-table-column>
                        <el-table-column label="产品单位"
                                         prop="unit">
                        </el-table-column>
                        <el-table-column align="right">
                            <template slot-scope="scope">
                                <el-button size="mini"
                                           type="danger"
                                           v-on:click="handleDelete(scope.$index)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </template>
            </div>
        </div>
        @*订单信息*@
        <div id="footbody">
        <div id="app2" style="">
            <table class="table1">
                <tr>
                    <td class="texttd">客户名称：</td>
                    <td class="inputtd">
                        <el-select v-model="name" placeholder="请选择">
                            <el-option v-for="item in options1" :value="item">
                            </el-option>
                        </el-select>
                    </td>
                    <td class="texttd">下单时间：</td>
                    <td class="inputtd">
                        <el-date-picker v-model="xdtime" type="date" placeholder="选择日期"> </el-date-picker>
                    </td>
                    <td class="texttd">交付时间：</td>
                    <td class="inputtd">
                        <el-date-picker v-model="jftime" type="date" placeholder="选择日期"> </el-date-picker>
                    </td>
                </tr>
                <tr>
                    <td class="texttd">操作人：</td>
                    <td class="inputtd">
                        <el-input placeholder="请输入内容" v-model="czr" clearable></el-input>
                    </td>
                    <td class="texttd">经手人：</td>
                    <td class="inputtd">
                        <el-input placeholder="请输入内容" v-model="jsr" clearable></el-input>
                    </td>
                    <td class="texttd">订单状态：</td>
                    <td class="inputtd">
                        <el-select v-model="type" placeholder="请选择">
                            <el-option v-for="item in options2" :value="item">
                            </el-option>
                        </el-select>
                    </td>
                </tr>
                <tr>
                    <td class="texttd">已付金额：</td>
                    <td class="inputtd">
                        <el-input placeholder="请输入内容" v-model="yfprice" clearable></el-input>
                    </td>
                    <td class="texttd">未付金额：</td>
                    <td class="inputtd">
                        <el-input placeholder="请输入内容" v-model="wfprice" clearable></el-input>
                    </td>
                    <td class="texttd">交货方式：</td>
                    <td class="inputtd">
                        <el-input placeholder="请输入内容" v-model="jhfs" clearable></el-input>
                    </td>
                </tr>
                <tr>
                    <td colspan="3" class="btn">
                        <el-button type="primary" onclick="addcancel()">取消</el-button>
                    </td>
                    <td colspan="3" class="btn">
                        <el-button type="danger" onclick="tijiao()">提交</el-button>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    </div>
    <script src="~/Scripts/jquery-3.4.1.js"></script>
    <script src="~/Scripts/vue.min.js"></script>
    <script src="~/Scripts/ElementUI/element-ui.js"></script>
    <script>
        //查询所有用户名
        $.ajax({
            url: "https://localhost:44397/Customer/customername",
            type: "get",
            success: function (data) {
                var info = eval(data);
                for (var i = 0; i < info.length; i++) {
                    vmapp2.options1.push(info[i].name);
                }

            }
        })
        var vm = new Vue({
            el: "#app",
            data() {
                return {
                    num: 1,
                    dialogVisible: false,
                }
            },
        })
        $.ajax({
            url: "https://localhost:44397/Customer/productname",
            type: "get",
            success: function (data) {
                var info = eval(data);
                for (var i = 0; i < info.length; i++) {
                    vm3.options.push(info[i].name);
                }

           }
        })
        function addinfo() {
            vm.dialogVisible = true;
        }
        //订单详情
        var vm1 = new Vue({
            el: "#bodycontent",
            data() {
                return {
                    tableData: [{
                        product_id: "", product_name: "", product_details_num: "", price: "", unit: ""
                    }],
                    
                   product_id: "", product_name: "", product_details_num: "", price: "", unit: "",
                    num: 1,
                    index: 0
                }
            },
            methods: {
                handleDelete(index) {
                    console.log(index);
                    this.$confirm('确定删除吗？')
                        .then(_ => {
                            //删除索引为index的一条数据
                            this.tableData.splice(index, 1);
                        })
                        .catch(_ => { });
                },
                //确定修改
                confirm() {
                    this.visible = false;
                    this.tableData[this.index].product_details_num = this.num;
                }
            },
        })
        //其他信息
        //表单app2
        var vmapp2 = new Vue({
            el: '#app2',
            data: function () {
                return {
                    visible: true,
                    name: "",
                    type: "",
                    xdtime: "",
                    jftime: '',
                    czr: '',
                    jsr: '',
                    yfprice: '',
                    wfprice: '',
                    jhfs: '',
                    options1: [],
                    fullscreenLoading: false,
                    options2: ["未处理"],
                    pickerOptions: {
                        disabledDate(time) {
                            return time.getTime() > Date.now();
                        },
                    },
                }
            },
        });
        //根据名字出来的产品信息
        var vm3 = new Vue({
            el: "#add",
            data() {
                return {
                    options: [],
                    name: "",
                    id: "",
                    size: "",
                    type: "",
                    unit: "",
                    price: "",
                    address: "",
                    num: "",
                    producer: "",

                }
            },
            watch: {
                name(newstring) {
                    //查数据返回赋值
                    $.ajax({
                        url: "https://localhost:44397/Customer/productnameselete?name=" + newstring,
                        type: "get",
                        success: function (data) {
                            var info = eval(data);
                            console.log(info[0]);
                            vm3.name = info[0].product_name;
                            vm3.id = info[0].product_id;
                            vm3.size = info[0].size;
                            vm3.type = info[0].product_type;
                            vm3.unit = info[0].unit;
                            vm3.price = info[0].product_price;
                            vm3.address = info[0].product_address;
                            vm3.num = info[0].product_num;

                            vm3.producer = info[0].product_producer;
                        }
                    })
                }
            }
        })
        //新增订单详情确定按钮
        function addqueding() {
            //然后进行查询显示（这里暂时不需要进行数据库的新增，
            if (vm1.tableData[0].product_id!="") {
                var info = {
                    product_id: "", product_name: "", product_details_num: "", price: "", unit: ""
                }
                info.product_id = vm3.id; info.product_name = vm3.name; info.product_details_num = vm.num;
                info.price = vm3.price; info.unit = vm3.unit;
                vm1.tableData.push(info);
            }
            else {
                vm1.tableData[0].product_id = vm3.id;
                vm1.tableData[0].product_name = vm3.name;
                vm1.tableData[0].product_details_num = vm.num;
                vm1.tableData[0].price = vm3.price;
                vm1.tableData[0].unit = vm3.unit;
            }
            //隐藏弹框
            vm.dialogVisible = false;
        }
        //新增订单确定按钮
        function tijiao() {
            if (vmapp2.name == '' || vmapp2.type == '' || vmapp2.xdtime == ''
                || vmapp2.jftime == '' || vmapp2.czr == '' || vmapp2.jsr == '' || vmapp2.yfprice == ''
                || vmapp2.wfprice == '' || vmapp2.jhfs == '') {
                const h = vm1.$createElement;
                vm1.$notify({
                    title: '新增订单',
                    message: h('i', { style: 'color: red' }, '新增订单失败，请填写完整数据')
                });
            } else {
                console.log(vmapp2.xdtime);
                //转为JSON字符串
                var json1 = {
                    "customer_name": vmapp2.name,
                    "order_starttime": vmapp2.xdtime,
                    "order_endtime": vmapp2.jftime,
                    "person_handling": vmapp2.jsr,
                    "operator_per": vmapp2.czr,
                    "order_paid": vmapp2.yfprice,
                    "order_unpaid": vmapp2.wfprice,
                    "order_delivery_way": vmapp2.jhfs,
                    "order_status": vmapp2.type,
                    "infoList": []
                };
                for (var i = 0; i < vm1.tableData.length; i++) {
                    var info = {"product_id":"", "product_name": "", "product_details_num": "","pro_price":""}
                    info.product_id = vm1.tableData[i].product_id;
                    info.product_name = vm1.tableData[i].product_name;
                    info.product_details_num = vm1.tableData[i].product_details_num;
                    info.pro_price = vm1.tableData[i].price;
                    json1.infoList.push(info);
                    info = { "product_id": "", "product_name": "", "product_details_num": "", "pro_price": ""}
                }
                var json2 = JSON.stringify(json1);
                console.log(json2);
                //新增数据
                $.ajax({
                    url: "https://localhost:44397/Customer/add_customer_order?json="+json2,
                    type: "post",
                    dataType: "json",
                    contentType: 'application/json;charset=utf-8',
                    success: function (data) {
                        console.log("进来了");
                    }
                })
                //效果展示
                setTimeout(() => {
                    const h = vm1.$createElement;
                    vm1.$notify({
                        title: '新增订单',
                        message: h('i', { style: 'color: teal' }, '新增订单成功')
                    });
                    setTimeout(() => {
                        //跳转到计划查询页面
                        window.location.href = "@Url.Content("~/customer/manage/")";
                    }, 1000);
                }, 1000);
            }
        }
    </script>
</body>
</html>
